name: 2-Test - Build # Nom du Workflow
on:
  workflow_dispatch # Déclenchement manuel

env:
  RG_NAME: "RG-AKS-0007"  # Nom du "resource group"
  ACR_NAME: "acraks00001" # Nom de Azure Container Registry
  IMAGE_NAME: "azure-vote-front"  # Nom de l'image Docker

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:

    # Step 1
    # Checkout du repo.
    # https://github.com/marketplace/actions/checkout


    # Step 2
    # Connexion à Azure
    # https://github.com/marketplace/actions/azure-login

    # Step 3
    # Récupération des credentials Azure Container Registry (Pas les bonnes pratriques)    
    - name: Get Key ACR
      run: |
        key=`az acr credential show --resource-group ${{ env.RG_NAME }} --name ${{ env.ACR_NAME}} --query passwords[0].value --output tsv`
        echo "::set-output name=content::$key"
      id: var_acrkey

    # Step 4
    # Connexion Azure Container Registry
    # https://github.com/marketplace/actions/azure-container-registry-login
    # Pour le password mettre  "${{ steps.var_acrkey.outputs.content }}" 

    # Step 5
    # Build (runner) & Push (Azure Container Registry)
    # https://docs.microsoft.com/fr-fr/azure/aks/kubernetes-action
    #- name: Build & Push
    #  run: |
    #    cd Src && docker build .   ................
    #    docker push ..................